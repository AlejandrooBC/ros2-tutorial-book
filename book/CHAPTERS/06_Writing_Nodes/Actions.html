
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4.6. Actions &#8212; A Guide to ROS2</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'book/CHAPTERS/06_Writing_Nodes/Actions';</script>
    <link rel="canonical" href="https://AlejandrooBC.github.io/ros2-tutorial-book/book/CHAPTERS/06_Writing_Nodes/Actions.html" />
    <link rel="icon" href="../../../_static/fav.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Bibliography" href="../../APPENDICES/Bibliography.html" />
    <link rel="prev" title="4.4. Services" href="Services.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/A_Guide_to_ROS2_Transparent_Logo.png" class="logo__image only-light" alt="A Guide to ROS2 - Home"/>
    <img src="../../../_static/A_Guide_to_ROS2_Transparent_Logo.png" class="logo__image only-dark pst-js-only" alt="A Guide to ROS2 - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction and Overview</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../INTRODUCTION/About_the_Authors.html">About the Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../INTRODUCTION/Preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../INTRODUCTION/Table_of_Contents.html">Table of Contents</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapters</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../01_Introduction_to_ROS2.html">1. Introduction to ROS2</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02_Setting_Up_a_ROS2_Environment.html">2. Setting Up a ROS2 Environment</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02_Setting_Up_an_Environment/ROS2IronInstallationWindows.html">2.6. Step 1: System Setup for Installing ROS2 Iron (Windows 10/11)</a></li>






















<li class="toctree-l2"><a class="reference internal" href="../02_Setting_Up_an_Environment/ROS2VMInstall.html">2.29. Windows 10/11 VM Instructions</a></li>











<li class="toctree-l2"><a class="reference internal" href="../02_Setting_Up_an_Environment/ROS2IronInstallationMacOS.html">2.41. Step 1: System Setup for ROS2 Iron on macOS</a></li>





<li class="toctree-l2"><a class="reference internal" href="../02_Setting_Up_an_Environment/ROS2IronInstallationUbuntu.html">2.47. Step 1: System Setup for Installing ROS2 Iron (Ubuntu 22)</a></li>








<li class="toctree-l2"><a class="reference internal" href="../02_Setting_Up_an_Environment/DockerInstallation.html">2.56. First Time Installation</a></li>


</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../03_Basic_ROS2_Concepts.html">3. Basic ROS2 Concepts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../03_Basic_Concepts/Nodes_and_Topics.html">3.1. Nodes and Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_Basic_Concepts/Services.html">3.2. Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_Basic_Concepts/Actions.html">3.3. Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_Basic_Concepts/Parameters.html">3.4. Parameters</a></li>



</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="WritingNodes.html">4. Writing Nodes</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Packages.html">4.1. Creating Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="PackageCommands.html">4.2. Package Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="BasicNodes.html">4.3. Basic ROS Nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="Services.html">4.4. Services</a></li>

<li class="toctree-l2 current active"><a class="current reference internal" href="#">4.6. Actions</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../APPENDICES/Bibliography.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/AlejandrooBC/ros2-tutorial-book/master?urlpath=tree/book/CHAPTERS/06_Writing_Nodes/Actions.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/AlejandrooBC/ros2-tutorial-book/blob/master/book/CHAPTERS/06_Writing_Nodes/Actions.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/AlejandrooBC/ros2-tutorial-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/AlejandrooBC/ros2-tutorial-book/edit/main/book/CHAPTERS/06_Writing_Nodes/Actions.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/AlejandrooBC/ros2-tutorial-book/issues/new?title=Issue%20on%20page%20%2Fbook/CHAPTERS/06_Writing_Nodes/Actions.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/book/CHAPTERS/06_Writing_Nodes/Actions.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Actions</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#topics-vs-services-vs-actions">4.6.1. Topics vs Services vs Actions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#asynchronous-programming">4.6.2. Asynchronous Programming</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#async-methods">4.6.2.1. Async Methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#futures">4.6.2.2. Futures</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#programming-with-client-actions">4.6.3. Programming with Client Actions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#send-goal">4.6.3.1. Send Goal</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#goal-handles">4.6.3.2. Goal Handles</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#status">4.6.3.2.1. Status</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#get-result">4.6.3.2.2. Get Result</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cancel-goal">4.6.3.2.3. Cancel Goal</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feedback">4.6.3.3. Feedback</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="actions">
<h1><span class="section-number">4.6. </span>Actions<a class="headerlink" href="#actions" title="Link to this heading">#</a></h1>
<p>The last type of connection that we are going to cover are Actions.</p>
<p>Actions are a combination of Services and Topics. They are initiated by calls to an action server, just like services are initiated by calls to a regular server. However, action services provide intermittent feedback by publishing to a topic that the action client can subscribe to. So, when should you use each?</p>
<section id="topics-vs-services-vs-actions">
<h2><span class="section-number">4.6.1. </span>Topics vs Services vs Actions<a class="headerlink" href="#topics-vs-services-vs-actions" title="Link to this heading">#</a></h2>
<p>Topics, services, and actions can all be used to transfer information between nodes, but they have different use cases.</p>
<p>Topics should be used for passing streams of information that are always relevant. For example, when a turtle exists in turtlesim, it is constantly publishing its current position over the <code class="docutils literal notranslate"><span class="pre">/turtle1/pose</span></code> topic, and is constantly reading a desired velocity over the <code class="docutils literal notranslate"><span class="pre">/turtle1/cmd_vel</span></code>. These topics constantly accepting and publishing data, and are valid as long as <code class="docutils literal notranslate"><span class="pre">turtle1</span></code> exists. Note that publishing to <code class="docutils literal notranslate"><span class="pre">cmd_vel</span></code>, despite only representing information, still causes the turtle to move. Topics can be used to cause something to happen.</p>
<p>Services should be used for requesting something quick to happen. The <code class="docutils literal notranslate"><span class="pre">turtlesim</span></code> node exposes several services that can be requested through service calls, like <code class="docutils literal notranslate"><span class="pre">/spawn</span></code> to spawn a turtle, or <code class="docutils literal notranslate"><span class="pre">/reset</span></code> to reset the simulation. These happen almost instantaneously, and there is no need for feedback while the server is executing the action. Services can return info, like in the case of <code class="docutils literal notranslate"><span class="pre">/spawn</span></code>, which returns the name of the created turtle.</p>
<!-- TODO this needs to be proofread. I tried very hard to not use "action", as in "something that happens" when I wasn't talking about the "Action" node connection, but I think it comes of as weird to read. -->
<p>Actions should be used for requesting something that might take a while, that would require feedback. <code class="docutils literal notranslate"><span class="pre">turtlesim</span></code> exposes one action, <code class="docutils literal notranslate"><span class="pre">turtle1/rotate_absolute</span></code>. This causes the turtle to turn to a position, but since the turtle can’t turn instantaneously, an action is used to keep the client updated on the turning progress.</p>
</section>
<section id="asynchronous-programming">
<h2><span class="section-number">4.6.2. </span>Asynchronous Programming<a class="headerlink" href="#asynchronous-programming" title="Link to this heading">#</a></h2>
<section id="async-methods">
<h3><span class="section-number">4.6.2.1. </span>Async Methods<a class="headerlink" href="#async-methods" title="Link to this heading">#</a></h3>
<p>In the services tutorial, we glossed over an important method call: <code class="docutils literal notranslate"><span class="pre">call_async()</span></code>. We used that method to <em>asynchronously</em> call our services, as opposed to using <em>synchronous</em> calls via <code class="docutils literal notranslate"><span class="pre">call()</span></code>.</p>
<p>A synchronous call is like a regular function call, where everything happens in the order you expect it to. Take this modified function from the services activity:</p>
<!-- TODO I need a better example for async vs sync calls. This one was easy to grab, but it doesn't actually illustrate anything. -->
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">set_pen_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">SetPen</span><span class="p">,</span> <span class="s1">&#39;/turtle1/set_pen&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_pen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">SetPen</span><span class="o">.</span><span class="n">Request</span><span class="p">()</span>
        <span class="c1"># Set R, G, B, and width</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pen_client</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</pre></div>
</div>
<p>This makes a synchronous call to the <code class="docutils literal notranslate"><span class="pre">set_pen</span></code> server from our <code class="docutils literal notranslate"><span class="pre">set_pen</span></code> client. The last line will request that the server change the pen color, and it will not move on until the service has come back and said either: “The pen color has been set,” or “The request failed.” This is called a blocking operation, since it blocks all code after it until it finishes. Compare that to the function that we actually used:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">set_pen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">SetPen</span><span class="o">.</span><span class="n">Request</span><span class="p">()</span>
        <span class="c1"># Set R, G, B, and width</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_pen_client</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</pre></div>
</div>
<p>This makes an <em>asynchronous</em> call to the <code class="docutils literal notranslate"><span class="pre">set_pen</span></code> server. The last line will request that the server sets the pen color, but it won’t actually wait for the server to confirm that the pen color has been set. This allows your code to do other things while ROS2 is busy passing messages around. This is a non-blocking operation. Importantly, synchronous calls <strong>cannot</strong> be used inside callbacks. This is because callbacks are called by ROS2, and synchronous calls are blocking. If you ask ROS2 to make a call, but then tell it not to do anything until the call is complete, ROS2 can’t complete your call and will get stuck!</p>
<p>Asynchronous calls are usually good to use, but they introduce some complexity into your program. If you need to get the result of a call, you can’t be sure that the call has actually been completed yet! This is where futures come in.</p>
</section>
<section id="futures">
<h3><span class="section-number">4.6.2.2. </span>Futures<a class="headerlink" href="#futures" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Future</span></code>s in <code class="docutils literal notranslate"><span class="pre">rclpy</span></code> represent the outcome of some task. Usually when you create or recieve a <code class="docutils literal notranslate"><span class="pre">Future</span></code>, that task is not yet done. Futures allow you to check if a task is done by calling the <code class="docutils literal notranslate"><span class="pre">done()</span></code> method, and get the result of the task using the <code class="docutils literal notranslate"><span class="pre">result()</span></code> method.</p>
<p>For services, futures will resolve to the result of the service. So, if a service called <code class="docutils literal notranslate"><span class="pre">/spawn</span></code> returns a response with<code class="docutils literal notranslate"><span class="pre">string</span> <span class="pre">name</span></code>, you can get <code class="docutils literal notranslate"><span class="pre">name</span></code> with the following line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">spawn_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">Spawn</span><span class="p">,</span> <span class="s1">&#39;/spawn&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">spawn_future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spawn_client</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="n">Spawn</span><span class="o">.</span><span class="n">Request</span><span class="p">())</span>
<span class="bp">self</span><span class="o">.</span><span class="n">create_timer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_name</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">print_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spawn_future</span><span class="o">.</span><span class="n">done</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spawn_future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">print_name()</span></code> is called, if <code class="docutils literal notranslate"><span class="pre">/spawn</span></code> has completed, it will print the name that was returned. Note that we use <code class="docutils literal notranslate"><span class="pre">create_timer</span></code> to run <code class="docutils literal notranslate"><span class="pre">print_name()</span></code> every 1 second. Alternatively, <code class="docutils literal notranslate"><span class="pre">add_done_callback</span></code> can be used to trigger a callback once, as soon as the result resolves. We don’t need to check if the future is done, since if the callback is called, we know that the future finished. In a more complex example, we might want some error checking on the future, but for simplicity we are excluding that check for now.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">spawn_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span><span class="n">Spawn</span><span class="p">,</span> <span class="s1">&#39;/spawn&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">spawn_future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spawn_client</span><span class="o">.</span><span class="n">call_async</span><span class="p">(</span><span class="n">Spawn</span><span class="o">.</span><span class="n">Request</span><span class="p">())</span>
<span class="bp">self</span><span class="o">.</span><span class="n">spawn_future</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">print_name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">print_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">future</span><span class="p">:</span> <span class="n">Future</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>The above examples show futures as used with services. Actions futures are similar, but have a different result type.</p>
</section>
</section>
<section id="programming-with-client-actions">
<h2><span class="section-number">4.6.3. </span>Programming with Client Actions<a class="headerlink" href="#programming-with-client-actions" title="Link to this heading">#</a></h2>
<section id="send-goal">
<h3><span class="section-number">4.6.3.1. </span>Send Goal<a class="headerlink" href="#send-goal" title="Link to this heading">#</a></h3>
<p>Like services, actions can be called both synchronously and asynchronously. However, for purposes of this tutorial, <strong>actions should almost never be called synchronously</strong>. We have established that actions are a good fit for long-running actions, and we also saw how synchronous calls were blocking calls. If we make a blocking call that takes a long time in the main loop of the node, we’re going to run into unexpected behavior! Additionally, synchronous action calls function almost identically to service calls, in that we aren’t able to make use of the feedback part of actions. We will simply have a service that takes a long time to execute. Still, for completeness, calling actions synchronously can be done like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">rotate_client</span> <span class="o">=</span> <span class="n">ActionClient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RotateAbsolute</span><span class="p">,</span> <span class="s1">&#39;/turtle1/rotate_absolute&#39;</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">rotate_to_goal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="n">RotateAbsolute</span><span class="o">.</span><span class="n">Goal</span><span class="p">()</span>
    <span class="n">goal</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">angle</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_client</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span>
</pre></div>
</div>
<p>Most of the time we should call actions asynchronously. Actions can be called asynchronously like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rotate_to_goal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="n">RotateAbsolute</span><span class="o">.</span><span class="n">Goal</span><span class="p">()</span>
    <span class="n">goal</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">angle</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_client</span><span class="o">.</span><span class="n">send_goal_async</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span>
</pre></div>
</div>
<p>Like with sevices, this function will return a <code class="docutils literal notranslate"><span class="pre">Future</span></code>. However, getting feedback and the final result is a little more complicated.</p>
<p>Actions operate in 4 stages:</p>
<ol class="arabic simple">
<li><p>We, the action client, make a request to the action server. At this point, the future is not done, and the result is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p>The action server recieves and processes our request, and responds. At this point, the future is done, and the result is a <code class="docutils literal notranslate"><span class="pre">GoalHandle</span></code> with an <code class="docutils literal notranslate"><span class="pre">Accepted</span></code> or <code class="docutils literal notranslate"><span class="pre">Executing</span></code> status.</p></li>
<li><p>The action server periodically sends feedback to our action client if we gave it a callback function. At this point, the future is done and the result is a <code class="docutils literal notranslate"><span class="pre">GoalHandle</span></code> with an <code class="docutils literal notranslate"><span class="pre">Accepted</span></code> or <code class="docutils literal notranslate"><span class="pre">Executing</span></code> status.</p></li>
<li><p>The action server finishes the action. At this point, the future is done and the result is a <code class="docutils literal notranslate"><span class="pre">GoalHandle</span></code> with the <code class="docutils literal notranslate"><span class="pre">Succeeded</span></code> status.</p></li>
</ol>
<p>You may have noticed that the future finished at step 2! As a reminder, with services we were able to use the results right after our future finished. With actions, the future only tells us whether or not the server has accepted our request, not if it is done or not. That means once we have our <code class="docutils literal notranslate"><span class="pre">GoalHandle</span></code>, we need to use that to determine if our action has finished or not.</p>
</section>
<section id="goal-handles">
<h3><span class="section-number">4.6.3.2. </span>Goal Handles<a class="headerlink" href="#goal-handles" title="Link to this heading">#</a></h3>
<p>Goal handles are resources we can use to interact with the action while it is executing. Goal handles have the following important properties:</p>
<section id="status">
<h4><span class="section-number">4.6.3.2.1. </span>Status<a class="headerlink" href="#status" title="Link to this heading">#</a></h4>
<p>Access with: <code class="docutils literal notranslate"><span class="pre">my_goal_handle</span></code>.status</p>
<p><code class="docutils literal notranslate"><span class="pre">status</span></code>. Status tells you important information about the progress of your goal. The valid states are:</p>
<ol class="arabic simple" start="0">
<li><p>Unknown (STATUS_UNKNOWN): This is not a valid state. If you encounter this, something has gone wrong.</p></li>
<li><p>Accepted (STATUS_ACCEPTED): The action server has acknowledged your request to do something, and will start executing it when it can.</p></li>
<li><p>Executing (STATUS_EXECUTING): The action server is currently executing your request, but has not yet finished.</p></li>
<li><p>Canceling (STATUS_CANCELING): You, the client, have requested that your request be canceled. The server is canceling your request, but has not yet finished.</p></li>
<li><p>Succeeded (STATUS_SUCCEEDED): The action server has already completed your request, and is doing something else.</p></li>
<li><p>Canceled (STATUS_CANCELED): You, the client, have requested that your request be canceled. The server has already canceled your request, and is doing something else.</p></li>
<li><p>Aborted (STATUS_ABORTED): Something went wrong, and the server stopped executing your goal and will not finish. Unlike canceling, you did <em>not</em> ask the server to stop executing the goal.</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">status</span></code> is an integer, and can be from 0-6. The numbers in the above states correspond to what they mean, but you should use the constants defined in <code class="docutils literal notranslate"><span class="pre">rclpy</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rclpy.action.client</span> <span class="kn">import</span> <span class="n">Goal</span>

<span class="c1"># ...</span>

<span class="k">if</span> <span class="n">my_goal_handle</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GoalStatus</span><span class="o">.</span><span class="n">STATUS_SUCCEEDED</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c1"># Do something!</span>
</pre></div>
</div>
</section>
<section id="get-result">
<h4><span class="section-number">4.6.3.2.2. </span>Get Result<a class="headerlink" href="#get-result" title="Link to this heading">#</a></h4>
<p>Access with <code class="docutils literal notranslate"><span class="pre">my_goal_handle.get_result()</span></code> or <code class="docutils literal notranslate"><span class="pre">my_goal_handle.get_result_async()</span></code>. For reasons discussed <a class="reference internal" href="#asynchronous-programming"><span class="xref myst">before</span></a> you should almost always use <code class="docutils literal notranslate"><span class="pre">my_goal_handle.get_result_async()</span></code>.</p>
<p>Calling <code class="docutils literal notranslate"><span class="pre">get_result()</span></code> will stop the node from doing anything until the action completes, and then will return the final result, just like calling <code class="docutils literal notranslate"><span class="pre">result</span></code> on a <code class="docutils literal notranslate"><span class="pre">Future</span></code>.</p>
<p>Calling <code class="docutils literal notranslate"><span class="pre">get_result_async()</span></code> will return a future. This means that, over the course of an action call, you will deal with 2 futures: On <code class="docutils literal notranslate"><span class="pre">send_goal_async</span></code> which finishes when the action server accepts the request, and on <code class="docutils literal notranslate"><span class="pre">get_result_async</span></code> which finishes when the action server finishes the action. Don’t get confused, the future returned by <code class="docutils literal notranslate"><span class="pre">send_goal_async</span></code> won’t tell you nearly enough information about the status of your goal! The result of this new future will be the final ROS2 result message from the server.</p>
</section>
<section id="cancel-goal">
<h4><span class="section-number">4.6.3.2.3. </span>Cancel Goal<a class="headerlink" href="#cancel-goal" title="Link to this heading">#</a></h4>
<p>Access with <code class="docutils literal notranslate"><span class="pre">my_goal_handle.cancel_goal()</span></code> or <code class="docutils literal notranslate"><span class="pre">my_goal_handle.cancel_goal_async()</span></code>. Prefer the async version of the method.</p>
<p>Canceling the goal will cause the action server to stop executing the goal the client asked it to execute. This will result in the <code class="docutils literal notranslate"><span class="pre">canceling</span></code> or <code class="docutils literal notranslate"><span class="pre">canceled</span></code> status.</p>
</section>
</section>
<section id="feedback">
<h3><span class="section-number">4.6.3.3. </span>Feedback<a class="headerlink" href="#feedback" title="Link to this heading">#</a></h3>
<p>The main advantage actions have over services is their ability to send a stream of feedback while the server is executing the goal. You can define a feedback with <code class="docutils literal notranslate"><span class="pre">send_goal_async()</span></code>, but not with <code class="docutils literal notranslate"><span class="pre">send_goal()</span></code>. That’s because if you use the synchronous method <code class="docutils literal notranslate"><span class="pre">send_goal()</span></code>, your node can’t do anything else until the goal has finished, including process any feedback!</p>
<p>You can define a function to process feedback as soon as it arrives by specifying the feedback function as the second parameter to <code class="docutils literal notranslate"><span class="pre">send_goal_async</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">feedback_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feedback_msg</span><span class="p">):</span>
    <span class="n">feedback</span> <span class="o">=</span> <span class="n">feedback_msg</span><span class="o">.</span><span class="n">feedback</span> <span class="c1"># Take the feedback out of the message! This property is always called `feedback`.</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">feedback</span><span class="o">.</span><span class="n">result_field</span><span class="p">)</span> <span class="c1"># Use the result! The name of `result_field` is whatever the actual message result property is called.</span>

<span class="n">send_goal_async</span><span class="p">(</span><span class="n">goal</span><span class="p">,</span> <span class="n">feedback_callback</span><span class="p">)</span>
</pre></div>
</div>
<!-- TODO The Above function should be made more applicable, and pulled from an example. I didn't have an example on hand. -->
<p>Now, whenever the server sends feedback, the feedback_callback will be run and it will process the feedback immediately.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./book/CHAPTERS/06_Writing_Nodes"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Services.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">4.4. </span>Services</p>
      </div>
    </a>
    <a class="right-next"
       href="../../APPENDICES/Bibliography.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Bibliography</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#topics-vs-services-vs-actions">4.6.1. Topics vs Services vs Actions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#asynchronous-programming">4.6.2. Asynchronous Programming</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#async-methods">4.6.2.1. Async Methods</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#futures">4.6.2.2. Futures</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#programming-with-client-actions">4.6.3. Programming with Client Actions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#send-goal">4.6.3.1. Send Goal</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#goal-handles">4.6.3.2. Goal Handles</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#status">4.6.3.2.1. Status</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#get-result">4.6.3.2.2. Get Result</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cancel-goal">4.6.3.2.3. Cancel Goal</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feedback">4.6.3.3. Feedback</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By <br>Advisor - Dr. Kimberly Oakes<br>Semester - RCOS Fall 2024<br>Team - Learn ROS Through Python Turtle<br> Alejandro Begara Criado<br>Luca Vitti<br>Niko Baletin<br>Jeremy Goldberger
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../../../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>